# ClientMaster - Firm Management Portal

A premium, full-featured management portal designed for firms seeking precise control over their internal workflows. Manage clients, assign structured tasks, execute transparent workflow audits, and access comprehensive executive insights.

## Features At a Glance
- **Interactive Dashboards**: Role-specific dashboards for Admins, Employees ("Doers"), and Auditors.
- **Client Registry**: Maintain centralized records of client contacts and service requirements.
- **Advanced Task Engine**: Assign recurring duties and process workflows seamlessly with SLA tracking.
- **Audit & Compliance**: Built-in review processes‚Äîtasks aren't closed until authorized by an Auditor.
- **Secure Access Control**: Industry-standard robust bcrypt credential hashing and JWT role management.

---

## üöÄ Quickstart: Local Setup

This project uses an embedded SQLite engine for zero-configuration local development.

### 1. Prerequisites
- **Node.js** (v18 or higher recommended)
- **npm** or **yarn**

### 2. Download and Install
1. Clone or download this repository to your local machine.
2. Open a terminal in the project directory.
3. Install all dependencies:
   ```bash
   npm install
   ```

### 3. Connect Local Database (SQLite)
The application automatically provisions an embedded SQLite database if it doesn't exist.
1. Create a `.env` file in the root directory.
2. Add your local configuration:
   ```env
   # Database Configuration
   DB_PATH=database.sqlite
   
   # JWT Configuration (Change this to a secure random string!)
   JWT_SECRET=super-heroic-production-secret-key
   
   # Server Port
   PORT=3000
   ```

### 4. Run Development Server
```bash
npm run dev
```
Open `http://localhost:5173` in your browser.
*Note: The **very first user** to register via the `/signup` page is automatically granted `admin` credentials!*

---

## üå© Migrating to Supabase (PostgreSQL)

If you are ready to scale beyond a local embedded database, the application is structured to easily migrate to **Supabase**.

### Step 1: Create a Supabase Project
1. Go to [Supabase.com](https://supabase.com) and create a new project.
2. Navigate to the **SQL Editor** in your Supabase dashboard.

### Step 2: Execute Schema Migration
Copy and paste the following PostgreSQL query into the Supabase SQL Editor and run it to construct your remote schema:

```sql
-- Create Users Table
CREATE TABLE IF NOT EXISTS users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  role TEXT DEFAULT 'employee',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Create Clients Table
CREATE TABLE IF NOT EXISTS clients (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  contact_person TEXT,
  email TEXT,
  phone TEXT,
  services TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Create Tasks Table
CREATE TABLE IF NOT EXISTS tasks (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title TEXT NOT NULL,
  client_id BIGINT REFERENCES clients(id) ON DELETE SET NULL,
  doer_id BIGINT REFERENCES users(id) ON DELETE SET NULL,
  remarks TEXT,
  frequency TEXT,
  due_date_logic TEXT,
  due_date TIMESTAMPTZ,
  status TEXT DEFAULT 'Not Started',
  completed_at TIMESTAMPTZ,
  auditor_id BIGINT REFERENCES users(id) ON DELETE SET NULL,
  audit_status TEXT DEFAULT 'Pending',
  audit_remarks TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Create Audit History Table
CREATE TABLE IF NOT EXISTS task_history (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  task_id BIGINT REFERENCES tasks(id) ON DELETE CASCADE,
  user_id BIGINT REFERENCES users(id) ON DELETE SET NULL,
  user_name TEXT,
  action TEXT,
  details TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Step 3: Required Codebase Adjustments for Supabase
To link the application to Supabase, you must make a few adjustments to the backend architecture.

1. **Install the Supabase Client**:
   ```bash
   npm install @supabase/supabase-js
   ```
2. **Update your `.env` File**:
   Add your new Supabase keys (found in Supabase Settings > API):
   ```env
   SUPABASE_URL=https://your-project-url.supabase.co
   SUPABASE_KEY=your-anon-or-service-role-key
   JWT_SECRET=super-heroic-production-secret-key
   PORT=3000
   ```
3. **Refactor `src/db/database.ts`**:
   Replace the local SQLite initialization with the remote Supabase client:
   ```typescript
   import { createClient } from '@supabase/supabase-js';
   import dotenv from 'dotenv';
   dotenv.config();

   export const supabase = createClient(
     process.env.SUPABASE_URL!,
     process.env.SUPABASE_KEY!
   );
   ```
4. **Update API Routing Layers (`src/api/*.ts`)**:
   Currently, the application executes synchronous SQLite calls (e.g., `db.prepare(...).all()`). You must convert these to asynchronous Supabase calls in your API controllers. 
   **Example Refactor for `src/api/clients.ts`**:
   ```typescript
   // Old SQLite way: 
   // const clients = db.prepare('SELECT * FROM clients').all();
   
   // New Supabase way:
   // const { data: clients, error } = await supabase.from('clients').select('*');
   ```

---

## üè¢ Build & Production Environment

When you are ready to distribute or host the application publicly, you must compile the React code into optimized, static Javascript and CSS.

### 1. Build the Frontend Assets
Run the Vite build command:
```bash
npm run build
```
*This command compresses and bundles all UI logic into the `/dist` directory. The embedded Express backend automatically serves this `/dist` directory in Production mode!*

### 2. Run the Production Server
Start the Express API Server in production mode to serve the `dist` files:
```bash
# Set environment to production and start
NODE_ENV=production npm start

# Or simply use the provided batch script on Windows:
# Start_ClientMaster_Production.bat
```

## üåê Hosting Instructions

You can host ClientMaster on any Virtual Private Server (VPS) or PaaS provider (like Render, Heroku, or DigitalOcean App Platform).

### Example Deployment (Render.com)
1. Push your completed repository to a private GitHub repo.
2. Create a new **Web Service** on Render.
3. Configure settings:
   - **Environment**: `Node`
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm start`
4. Provide the Environmental Variables (`.env`) via the Render Dashboard.
5. Deploy! Render will build the React assets and spin up the Express server.

### Example Deployment (DigitalOcean App Platform)
1. Add your repository to the DigitalOcean Apps dashboard.
2. Select **Web Service**.
3. Set the build command to `npm run build` and the run command to `npm start`.
4. Inject your `.env` variables into the Environmental Variable settings panel.
5. Hit Deploy. The traffic will automatically route through their global CDN.
